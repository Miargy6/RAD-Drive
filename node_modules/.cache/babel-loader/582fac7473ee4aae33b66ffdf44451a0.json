{"ast":null,"code":"import { useReducer, useEffect, useState } from \"react\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { database } from \"../firebase\";\nimport fireDb from \"../firebase\";\nconst ACTIONS = {\n  SELECT_FOLDER: \"select-folder\",\n  UPDATE_FOLDER: \"update-folder\",\n  SET_CHILD_FOLDERS: \"set-child-folders\",\n  SET_CHILD_FILES: \"set-child-files\"\n};\nconst [data, setData] = useState({});\nexport const ROOT_FOLDER = {\n  name: \"Home\",\n  id: null,\n  path: []\n};\n\nfunction reducer(state, {\n  type,\n  payload\n}) {\n  switch (type) {\n    case ACTIONS.SELECT_FOLDER:\n      return {\n        folderId: payload.folderId,\n        folder: payload.folder,\n        childFiles: [],\n        childFolders: []\n      };\n\n    case ACTIONS.UPDATE_FOLDER:\n      return { ...state,\n        folder: payload.folder\n      };\n\n    case ACTIONS.SET_CHILD_FOLDERS:\n      return { ...state,\n        childFolders: payload.childFolders\n      };\n\n    case ACTIONS.SET_CHILD_FILES:\n      return { ...state,\n        childFiles: payload.childFiles\n      };\n\n    default:\n      return state;\n  }\n}\n\nexport function useFolder(folderId = null, folder = null) {\n  const [state, dispatch] = useReducer(reducer, {\n    folderId,\n    folder,\n    childFolders: [],\n    childFiles: []\n  });\n  const {\n    currentUser\n  } = useAuth();\n  useEffect(() => {\n    dispatch({\n      type: ACTIONS.SELECT_FOLDER,\n      payload: {\n        folderId,\n        folder\n      }\n    });\n  }, [folderId, folder]);\n  useEffect(() => {\n    if (folderId == null) {\n      return dispatch({\n        type: ACTIONS.UPDATE_FOLDER,\n        payload: {\n          folder: ROOT_FOLDER\n        }\n      });\n    }\n\n    database.folders.doc(folderId).get().then(doc => {\n      dispatch({\n        type: ACTIONS.UPDATE_FOLDER,\n        payload: {\n          folder: database.formatDoc(doc)\n        }\n      });\n    }).catch(() => {\n      dispatch({\n        type: ACTIONS.UPDATE_FOLDER,\n        payload: {\n          folder: ROOT_FOLDER\n        }\n      });\n    });\n  }, [folderId]);\n  useEffect(() => {\n    return database.folders.where(\"parentId\", \"==\", folderId).where(\"userId\", \"==\", currentUser.uid).orderBy(\"createdAt\").onSnapshot(snapshot => {\n      dispatch({\n        type: ACTIONS.SET_CHILD_FOLDERS,\n        payload: {\n          childFolders: snapshot.docs.map(database.formatDoc)\n        }\n      });\n    });\n  }, [folderId, currentUser]);\n  useEffect(() => {\n    return database.files.where(\"folderId\", \"==\", folderId).where(\"userId\", \"==\", currentUser.uid).orderBy(\"createdAt\").onSnapshot(snapshot => {\n      dispatch({\n        type: ACTIONS.SET_CHILD_FILES,\n        payload: {\n          childFiles: snapshot.docs.map(database.formatDoc)\n        }\n      });\n    });\n  }, [folderId, currentUser]);\n  useEffect(() => {\n    fireDb.child(\"tableDetail\").on(\"value\", snapshot => {\n      if (snapshot.val() !== null) {\n        setData({ ...snapshot.val()\n        });\n      } else {\n        setData({});\n      }\n    });\n    return () => {\n      setData({});\n    };\n  }, [folderId, currentUser]);\n  return state;\n}","map":{"version":3,"sources":["C:/Users/Mussagy/Desktop/CornelderDrive/src/hooks/useFolder.js"],"names":["useReducer","useEffect","useState","useAuth","database","fireDb","ACTIONS","SELECT_FOLDER","UPDATE_FOLDER","SET_CHILD_FOLDERS","SET_CHILD_FILES","data","setData","ROOT_FOLDER","name","id","path","reducer","state","type","payload","folderId","folder","childFiles","childFolders","useFolder","dispatch","currentUser","folders","doc","get","then","formatDoc","catch","where","uid","orderBy","onSnapshot","snapshot","docs","map","files","child","on","val"],"mappings":"AAAA,SAASA,UAAT,EAAqBC,SAArB,EAAgCC,QAAhC,QAAgD,OAAhD;AACA,SAASC,OAAT,QAAwB,yBAAxB;AACA,SAASC,QAAT,QAAyB,aAAzB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAIA,MAAMC,OAAO,GAAG;AACdC,EAAAA,aAAa,EAAE,eADD;AAEdC,EAAAA,aAAa,EAAE,eAFD;AAGdC,EAAAA,iBAAiB,EAAE,mBAHL;AAIdC,EAAAA,eAAe,EAAE;AAJH,CAAhB;AAMA,MAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBV,QAAQ,CAAC,EAAD,CAAhC;AAIA,OAAO,MAAMW,WAAW,GAAG;AAAEC,EAAAA,IAAI,EAAE,MAAR;AAAgBC,EAAAA,EAAE,EAAE,IAApB;AAA0BC,EAAAA,IAAI,EAAE;AAAhC,CAApB;;AAEP,SAASC,OAAT,CAAiBC,KAAjB,EAAwB;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAxB,EAA2C;AACzC,UAAQD,IAAR;AACE,SAAKb,OAAO,CAACC,aAAb;AACE,aAAO;AACLc,QAAAA,QAAQ,EAAED,OAAO,CAACC,QADb;AAELC,QAAAA,MAAM,EAAEF,OAAO,CAACE,MAFX;AAGLC,QAAAA,UAAU,EAAE,EAHP;AAILC,QAAAA,YAAY,EAAE;AAJT,OAAP;;AAMF,SAAKlB,OAAO,CAACE,aAAb;AACE,aAAO,EACL,GAAGU,KADE;AAELI,QAAAA,MAAM,EAAEF,OAAO,CAACE;AAFX,OAAP;;AAIF,SAAKhB,OAAO,CAACG,iBAAb;AACE,aAAO,EACL,GAAGS,KADE;AAELM,QAAAA,YAAY,EAAEJ,OAAO,CAACI;AAFjB,OAAP;;AAIF,SAAKlB,OAAO,CAACI,eAAb;AACE,aAAO,EACL,GAAGQ,KADE;AAELK,QAAAA,UAAU,EAAEH,OAAO,CAACG;AAFf,OAAP;;AAIF;AACE,aAAOL,KAAP;AAxBJ;AA0BD;;AAED,OAAO,SAASO,SAAT,CAAmBJ,QAAQ,GAAG,IAA9B,EAAoCC,MAAM,GAAG,IAA7C,EAAmD;AACxD,QAAM,CAACJ,KAAD,EAAQQ,QAAR,IAAoB1B,UAAU,CAACiB,OAAD,EAAU;AAC5CI,IAAAA,QAD4C;AAE5CC,IAAAA,MAF4C;AAG5CE,IAAAA,YAAY,EAAE,EAH8B;AAI5CD,IAAAA,UAAU,EAAE;AAJgC,GAAV,CAApC;AAMA,QAAM;AAAEI,IAAAA;AAAF,MAAkBxB,OAAO,EAA/B;AAEAF,EAAAA,SAAS,CAAC,MAAM;AACdyB,IAAAA,QAAQ,CAAC;AAAEP,MAAAA,IAAI,EAAEb,OAAO,CAACC,aAAhB;AAA+Ba,MAAAA,OAAO,EAAE;AAAEC,QAAAA,QAAF;AAAYC,QAAAA;AAAZ;AAAxC,KAAD,CAAR;AACD,GAFQ,EAEN,CAACD,QAAD,EAAWC,MAAX,CAFM,CAAT;AAIArB,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIoB,QAAQ,IAAI,IAAhB,EAAsB;AACpB,aAAOK,QAAQ,CAAC;AACdP,QAAAA,IAAI,EAAEb,OAAO,CAACE,aADA;AAEdY,QAAAA,OAAO,EAAE;AAAEE,UAAAA,MAAM,EAAET;AAAV;AAFK,OAAD,CAAf;AAID;;AAEDT,IAAAA,QAAQ,CAACwB,OAAT,CACGC,GADH,CACOR,QADP,EAEGS,GAFH,GAGGC,IAHH,CAGQF,GAAG,IAAI;AACXH,MAAAA,QAAQ,CAAC;AACPP,QAAAA,IAAI,EAAEb,OAAO,CAACE,aADP;AAEPY,QAAAA,OAAO,EAAE;AAAEE,UAAAA,MAAM,EAAElB,QAAQ,CAAC4B,SAAT,CAAmBH,GAAnB;AAAV;AAFF,OAAD,CAAR;AAID,KARH,EASGI,KATH,CASS,MAAM;AACXP,MAAAA,QAAQ,CAAC;AACPP,QAAAA,IAAI,EAAEb,OAAO,CAACE,aADP;AAEPY,QAAAA,OAAO,EAAE;AAAEE,UAAAA,MAAM,EAAET;AAAV;AAFF,OAAD,CAAR;AAID,KAdH;AAeD,GAvBQ,EAuBN,CAACQ,QAAD,CAvBM,CAAT;AAyBApB,EAAAA,SAAS,CAAC,MAAM;AACd,WAAOG,QAAQ,CAACwB,OAAT,CACJM,KADI,CACE,UADF,EACc,IADd,EACoBb,QADpB,EAEJa,KAFI,CAEE,QAFF,EAEY,IAFZ,EAEkBP,WAAW,CAACQ,GAF9B,EAGJC,OAHI,CAGI,WAHJ,EAIJC,UAJI,CAIOC,QAAQ,IAAI;AACtBZ,MAAAA,QAAQ,CAAC;AACPP,QAAAA,IAAI,EAAEb,OAAO,CAACG,iBADP;AAEPW,QAAAA,OAAO,EAAE;AAAEI,UAAAA,YAAY,EAAEc,QAAQ,CAACC,IAAT,CAAcC,GAAd,CAAkBpC,QAAQ,CAAC4B,SAA3B;AAAhB;AAFF,OAAD,CAAR;AAID,KATI,CAAP;AAUD,GAXQ,EAWN,CAACX,QAAD,EAAWM,WAAX,CAXM,CAAT;AAaA1B,EAAAA,SAAS,CAAC,MAAM;AACd,WACEG,QAAQ,CAACqC,KAAT,CACGP,KADH,CACS,UADT,EACqB,IADrB,EAC2Bb,QAD3B,EAEGa,KAFH,CAES,QAFT,EAEmB,IAFnB,EAEyBP,WAAW,CAACQ,GAFrC,EAGGC,OAHH,CAGW,WAHX,EAIGC,UAJH,CAIcC,QAAQ,IAAI;AACtBZ,MAAAA,QAAQ,CAAC;AACPP,QAAAA,IAAI,EAAEb,OAAO,CAACI,eADP;AAEPU,QAAAA,OAAO,EAAE;AAAEG,UAAAA,UAAU,EAAEe,QAAQ,CAACC,IAAT,CAAcC,GAAd,CAAkBpC,QAAQ,CAAC4B,SAA3B;AAAd;AAFF,OAAD,CAAR;AAID,KATH,CADF;AAYD,GAbQ,EAaN,CAACX,QAAD,EAAWM,WAAX,CAbM,CAAT;AAeA1B,EAAAA,SAAS,CAAC,MAAM;AACdI,IAAAA,MAAM,CAACqC,KAAP,CAAa,aAAb,EAA4BC,EAA5B,CAA+B,OAA/B,EAAyCL,QAAD,IAAc;AACpD,UAAGA,QAAQ,CAACM,GAAT,OAAkB,IAArB,EAA0B;AACxBhC,QAAAA,OAAO,CAAC,EAAC,GAAG0B,QAAQ,CAACM,GAAT;AAAJ,SAAD,CAAP;AACD,OAFD,MAEM;AACJhC,QAAAA,OAAO,CAAC,EAAD,CAAP;AACD;AACF,KAND;AAOA,WAAM,MAAM;AACVA,MAAAA,OAAO,CAAC,EAAD,CAAP;AACD,KAFD;AAGD,GAXQ,EAWN,CAACS,QAAD,EAAWM,WAAX,CAXM,CAAT;AAaA,SAAOT,KAAP;AACD","sourcesContent":["import { useReducer, useEffect, useState } from \"react\"\nimport { useAuth } from \"../contexts/AuthContext\"\nimport { database } from \"../firebase\"\nimport fireDb from \"../firebase\"\n\n\n\nconst ACTIONS = {\n  SELECT_FOLDER: \"select-folder\",\n  UPDATE_FOLDER: \"update-folder\",\n  SET_CHILD_FOLDERS: \"set-child-folders\",\n  SET_CHILD_FILES: \"set-child-files\",\n}\nconst [data, setData] = useState({});\n\n\n\nexport const ROOT_FOLDER = { name: \"Home\", id: null, path: [] }\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case ACTIONS.SELECT_FOLDER:\n      return {\n        folderId: payload.folderId,\n        folder: payload.folder,\n        childFiles: [],\n        childFolders: [],\n      }\n    case ACTIONS.UPDATE_FOLDER:\n      return {\n        ...state,\n        folder: payload.folder,\n      }\n    case ACTIONS.SET_CHILD_FOLDERS:\n      return {\n        ...state,\n        childFolders: payload.childFolders,\n      }\n    case ACTIONS.SET_CHILD_FILES:\n      return {\n        ...state,\n        childFiles: payload.childFiles,\n      }\n    default:\n      return state\n  }\n}\n\nexport function useFolder(folderId = null, folder = null) {\n  const [state, dispatch] = useReducer(reducer, {\n    folderId,\n    folder,\n    childFolders: [],\n    childFiles: [],\n  })\n  const { currentUser } = useAuth()\n\n  useEffect(() => {\n    dispatch({ type: ACTIONS.SELECT_FOLDER, payload: { folderId, folder } })\n  }, [folderId, folder])\n\n  useEffect(() => {\n    if (folderId == null) {\n      return dispatch({\n        type: ACTIONS.UPDATE_FOLDER,\n        payload: { folder: ROOT_FOLDER },\n      })\n    }\n\n    database.folders\n      .doc(folderId)\n      .get()\n      .then(doc => {\n        dispatch({\n          type: ACTIONS.UPDATE_FOLDER,\n          payload: { folder: database.formatDoc(doc) },\n        })\n      })\n      .catch(() => {\n        dispatch({\n          type: ACTIONS.UPDATE_FOLDER,\n          payload: { folder: ROOT_FOLDER },\n        })\n      })\n  }, [folderId])\n\n  useEffect(() => {\n    return database.folders\n      .where(\"parentId\", \"==\", folderId)\n      .where(\"userId\", \"==\", currentUser.uid)\n      .orderBy(\"createdAt\")\n      .onSnapshot(snapshot => {\n        dispatch({\n          type: ACTIONS.SET_CHILD_FOLDERS,\n          payload: { childFolders: snapshot.docs.map(database.formatDoc) },\n        })\n      })\n  }, [folderId, currentUser])\n\n  useEffect(() => {\n    return (\n      database.files\n        .where(\"folderId\", \"==\", folderId)\n        .where(\"userId\", \"==\", currentUser.uid)\n        .orderBy(\"createdAt\")\n        .onSnapshot(snapshot => {\n          dispatch({\n            type: ACTIONS.SET_CHILD_FILES,\n            payload: { childFiles: snapshot.docs.map(database.formatDoc) },\n          })\n        })\n    )\n  }, [folderId, currentUser])\n\n  useEffect(() => {\n    fireDb.child(\"tableDetail\").on(\"value\", (snapshot) => {\n      if(snapshot.val()!== null){\n        setData({...snapshot.val()});\n      }else {\n        setData({});\n      }\n    });\n    return() => {\n      setData({});\n    };\n  }, [folderId, currentUser]);\n\n  return state\n}\n"]},"metadata":{},"sourceType":"module"}