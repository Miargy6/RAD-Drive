{"ast":null,"code":"var _jsxFileName = \"E:\\\\Mussagy\\\\Programming\\\\Curso\\\\firebase-google-drive-clone-main\\\\firebase-google-drive-clone-main\\\\google-drive-clone\\\\src\\\\components\\\\google-drive\\\\AddFileButton.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { faFileUpload } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { storage, database } from \"../../firebase\";\nimport { ROOT_FOLDER } from \"../../hooks/useFolder\";\nimport { v4 as uuidV4 } from \"uuid\";\nimport { ProgressBar, Toast } from \"react-bootstrap\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function AddFileButton(_ref) {\n  _s();\n\n  let {\n    currentFolder\n  } = _ref;\n  const [uploadingFiles, setUploadingFiles] = useState([]);\n  const {\n    currentUser\n  } = useAuth();\n\n  function handleUpload(e) {\n    const file = e.target.files[0];\n    if (currentFolder == null || file == null) return;\n    const id = uuidV4();\n    setUploadingFiles(prevUploadingFiles => [...prevUploadingFiles, {\n      id: id,\n      name: file.name,\n      progress: 0,\n      error: false\n    }]);\n    const filePath = currentFolder === ROOT_FOLDER ? `${currentFolder.path.join(\"/\")}/${file.name}` : `${currentFolder.path.join(\"/\")}/${currentFolder.name}/${file.name}`;\n    const uploadTask = storage.ref(`/files/${currentUser.uid}/${filePath}`).put(file);\n    uploadTask.on(\"state_changed\", snapshot => {\n      const progress = snapshot.bytesTransferred / snapshot.totalBytes;\n      setUploadingFiles(prevUploadingFiles => {\n        return prevUploadingFiles.map(uploadFile => {\n          if (uploadFile.id === id) {\n            return { ...uploadFile,\n              progress: progress\n            };\n          }\n\n          return uploadFile;\n        });\n      });\n    }, () => {\n      setUploadingFiles(prevUploadingFiles => {\n        return prevUploadingFiles.map(uploadFile => {\n          if (uploadFile.id === id) {\n            return { ...uploadFile,\n              error: true\n            };\n          }\n\n          return uploadFile;\n        });\n      });\n    }, () => {\n      setUploadingFiles(prevUploadingFiles => {\n        return prevUploadingFiles.filter(uploadFile => {\n          return uploadFile.id !== id;\n        });\n      });\n      uploadTask.snapshot.ref.getDownloadURL().then(url => {\n        database.files.where(\"name\", \"==\", file.name).where(\"userId\", \"==\", currentUser.uid).where(\"folderId\", \"==\", currentFolder.id).get().then(existingFiles => {\n          const existingFile = existingFiles.docs[0];\n\n          if (existingFile) {\n            existingFile.ref.update({\n              url: url\n            });\n          } else {\n            database.files.add({\n              url: url,\n              name: file.name,\n              createdAt: database.getCurrentTimestamp(),\n              folderId: currentFolder.id,\n              userId: currentUser.uid\n            });\n          }\n        });\n      });\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"btn btn-outline-success btn-sm m-0 mr-2\",\n      children: [/*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faFileUpload\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        onChange: handleUpload,\n        style: {\n          opacity: 0,\n          position: \"absolute\",\n          left: \"-9999px\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), uploadingFiles.length > 0 && /*#__PURE__*/ReactDOM.createPortal( /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: \"absolute\",\n        bottom: \"1rem\",\n        right: \"1rem\",\n        maxWidth: \"250px\"\n      },\n      children: uploadingFiles.map(file => /*#__PURE__*/_jsxDEV(Toast, {\n        onClose: () => {\n          setUploadingFiles(prevUploadingFiles => {\n            return prevUploadingFiles.filter(uploadFile => {\n              return uploadFile.id !== file.id;\n            });\n          });\n        },\n        children: [/*#__PURE__*/_jsxDEV(Toast.Header, {\n          closeButton: file.error,\n          className: \"text-truncate w-100 d-block\",\n          children: file.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Toast.Body, {\n          children: /*#__PURE__*/_jsxDEV(ProgressBar, {\n            animated: !file.error,\n            variant: file.error ? \"danger\" : \"primary\",\n            now: file.error ? 100 : file.progress * 100,\n            label: file.error ? \"Error\" : `${Math.round(file.progress * 100)}%`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 17\n        }, this)]\n      }, file.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 15\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 11\n    }, this), document.body)]\n  }, void 0, true);\n}\n\n_s(AddFileButton, \"/jTeNKu/d4kx56Z+GVBMZBIqdjo=\", false, function () {\n  return [useAuth];\n});\n\n_c = AddFileButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddFileButton\");","map":{"version":3,"sources":["E:/Mussagy/Programming/Curso/firebase-google-drive-clone-main/firebase-google-drive-clone-main/google-drive-clone/src/components/google-drive/AddFileButton.js"],"names":["React","useState","ReactDOM","faFileUpload","FontAwesomeIcon","useAuth","storage","database","ROOT_FOLDER","v4","uuidV4","ProgressBar","Toast","AddFileButton","currentFolder","uploadingFiles","setUploadingFiles","currentUser","handleUpload","e","file","target","files","id","prevUploadingFiles","name","progress","error","filePath","path","join","uploadTask","ref","uid","put","on","snapshot","bytesTransferred","totalBytes","map","uploadFile","filter","getDownloadURL","then","url","where","get","existingFiles","existingFile","docs","update","add","createdAt","getCurrentTimestamp","folderId","userId","opacity","position","left","length","createPortal","bottom","right","maxWidth","Math","round","document","body"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { faFileUpload } from \"@fortawesome/free-solid-svg-icons\"\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\nimport { useAuth } from \"../../contexts/AuthContext\"\nimport { storage, database } from \"../../firebase\"\nimport { ROOT_FOLDER } from \"../../hooks/useFolder\"\nimport { v4 as uuidV4 } from \"uuid\"\nimport { ProgressBar, Toast } from \"react-bootstrap\"\n\nexport default function AddFileButton({ currentFolder }) {\n  const [uploadingFiles, setUploadingFiles] = useState([])\n  const { currentUser } = useAuth()\n\n  function handleUpload(e) {\n    const file = e.target.files[0]\n    if (currentFolder == null || file == null) return\n\n    const id = uuidV4()\n    setUploadingFiles(prevUploadingFiles => [\n      ...prevUploadingFiles,\n      { id: id, name: file.name, progress: 0, error: false },\n    ])\n    const filePath =\n      currentFolder === ROOT_FOLDER\n        ? `${currentFolder.path.join(\"/\")}/${file.name}`\n        : `${currentFolder.path.join(\"/\")}/${currentFolder.name}/${file.name}`\n\n    const uploadTask = storage\n      .ref(`/files/${currentUser.uid}/${filePath}`)\n      .put(file)\n\n    uploadTask.on(\n      \"state_changed\",\n      snapshot => {\n        const progress = snapshot.bytesTransferred / snapshot.totalBytes\n        setUploadingFiles(prevUploadingFiles => {\n          return prevUploadingFiles.map(uploadFile => {\n            if (uploadFile.id === id) {\n              return { ...uploadFile, progress: progress }\n            }\n\n            return uploadFile\n          })\n        })\n      },\n      () => {\n        setUploadingFiles(prevUploadingFiles => {\n          return prevUploadingFiles.map(uploadFile => {\n            if (uploadFile.id === id) {\n              return { ...uploadFile, error: true }\n            }\n            return uploadFile\n          })\n        })\n      },\n      () => {\n        setUploadingFiles(prevUploadingFiles => {\n          return prevUploadingFiles.filter(uploadFile => {\n            return uploadFile.id !== id\n          })\n        })\n\n        uploadTask.snapshot.ref.getDownloadURL().then(url => {\n          database.files\n            .where(\"name\", \"==\", file.name)\n            .where(\"userId\", \"==\", currentUser.uid)\n            .where(\"folderId\", \"==\", currentFolder.id)\n            .get()\n            .then(existingFiles => {\n              const existingFile = existingFiles.docs[0]\n              if (existingFile) {\n                existingFile.ref.update({ url: url })\n              } else {\n                database.files.add({\n                  url: url,\n                  name: file.name,\n                  createdAt: database.getCurrentTimestamp(),\n                  folderId: currentFolder.id,\n                  userId: currentUser.uid,\n                })\n              }\n            })\n        })\n      }\n    )\n  }\n\n  return (\n    <>\n      <label className=\"btn btn-outline-success btn-sm m-0 mr-2\">\n        <FontAwesomeIcon icon={faFileUpload} />\n        <input\n          type=\"file\"\n          onChange={handleUpload}\n          style={{ opacity: 0, position: \"absolute\", left: \"-9999px\" }}\n        />\n      </label>\n      {uploadingFiles.length > 0 &&\n        ReactDOM.createPortal(\n          <div\n            style={{\n              position: \"absolute\",\n              bottom: \"1rem\",\n              right: \"1rem\",\n              maxWidth: \"250px\",\n            }}\n          >\n            {uploadingFiles.map(file => (\n              <Toast\n                key={file.id}\n                onClose={() => {\n                  setUploadingFiles(prevUploadingFiles => {\n                    return prevUploadingFiles.filter(uploadFile => {\n                      return uploadFile.id !== file.id\n                    })\n                  })\n                }}\n              >\n                <Toast.Header\n                  closeButton={file.error}\n                  className=\"text-truncate w-100 d-block\"\n                >\n                  {file.name}\n                </Toast.Header>\n                <Toast.Body>\n                  <ProgressBar\n                    animated={!file.error}\n                    variant={file.error ? \"danger\" : \"primary\"}\n                    now={file.error ? 100 : file.progress * 100}\n                    label={\n                      file.error\n                        ? \"Error\"\n                        : `${Math.round(file.progress * 100)}%`\n                    }\n                  />\n                </Toast.Body>\n              </Toast>\n            ))}\n          </div>,\n          document.body\n        )}\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}